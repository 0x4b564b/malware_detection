import pandas as pd
from .logger import logger

def predict_vulnerability(model, cve_data, exploit_data, vt_data, network_data, apk_data):
    logger.info("Starting prediction on new data")
    
    input_data = pd.DataFrame([{
        'cve_score': cve_data.get('score', 0),
        'exploitability': cve_data.get('exploitability', 0),
        'exploit_available': int(exploit_data.get('exploit_available', False)),
        'malicious': vt_data.get('malicious', 0),
        'harmless': vt_data.get('harmless', 0),
        'suspicious': vt_data.get('suspicious', 0),
        'open_ports': network_data.get('open_ports', 0),
        'vulnerable_services': network_data.get('vulnerable_services', 0),
        'traffic_pattern_anomalous': 1 if network_data.get('traffic_pattern') == 'anomalous' else 0,
        'permissions': apk_data.get('permissions', 0),
        'malicious_activity': apk_data.get('malicious_activity', 0),
        'obfuscation_level': apk_data.get('obfuscation_level', 0)
    }])

    prediction = model.predict(input_data)
    logger.info(f"Prediction result: {'Vulnerable' if prediction[0] == 1 else 'Not Vulnerable'}")
    return prediction[0]
