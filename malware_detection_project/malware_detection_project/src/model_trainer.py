from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score
from .logger import logger
import json

def load_model_config():
    logger.info("Loading model configuration")
    with open('config/model_config.json', 'r') as file:
        return json.load(file)

def train_model(df):
    logger.info("Starting model training")
    config = load_model_config()

    X = df.drop('is_vulnerable', axis=1)
    y = df['is_vulnerable']

    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=config['test_size'], random_state=config['random_state'])

    model = RandomForestClassifier(n_estimators=config['n_estimators'], random_state=config['random_state'])
    model.fit(X_train, y_train)

    y_pred = model.predict(X_test)
    accuracy = accuracy_score(y_test, y_pred)
    logger.info(f"Model training completed with accuracy: {accuracy * 100:.2f}%")

    return model
